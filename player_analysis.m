%% player_analysis
original_data = loadjson('.\data.json');
% score = load('score_after_player_simulation.mat','score');
% simulate_score = score.score; % load player score after simulation
player_performance = cell(250,1);
for i = 1:length(original_data)
    data = original_data{i};
    score = (1-data.score/3600/0.55/1000)*100*sign(data.score+1);
%     if simulate_score(i)>0
%         score = simulate_score(i);
%     else
%         score = 0;
%     end
    % if data(consumption) is -1, it is a failed trial.

    if isempty(player_performance{data.userid})
        player_performance{data.userid} = score;
        if score>30
            wait = 1;
        end
    else
        player_performance{data.userid} = [player_performance{data.userid}, score];
    end
end

%% plot performance
figure; hold all;
for i = 1:250
    if ~isempty(player_performance{i})
        data = player_performance{i};
        l = length(data);
        max_data = zeros(l,1);
        for j = 1:l
            max_data(j) = max(data(1:j));
        end
        plot(max_data,'LineWidth',3);
    end
end

%% how many plays in total after %play% plays
% play = 5;
% count = 0;
% for i = 1:250
%     if ~isempty(player_performance{i})
%         data = player_performance{i};
%         l = length(data);
%         if l>=play
%             count = count + 1;
%         end
%     end
% end

%% compare to EGO
% maxEGO = [1.6799999999999997,3.75,6.16,6.44,6.709999999999999,6.83,11.469999999999999,11.469999999999999,11.48,15.35,15.51,15.579999999999998,15.85,15.85,15.85,16.749999999999996,16.749999999999996,19.54,20.249999999999996,20.249999999999996,20.249999999999996,23.089999999999996,23.089999999999996,23.089999999999996,23.089999999999996,23.089999999999996,25.509999999999998,25.509999999999998,25.509999999999998,25.509999999999998,25.509999999999998,25.509999999999998,25.509999999999998,27.339999999999996,27.339999999999996,27.339999999999996,27.339999999999996,27.339999999999996,27.339999999999996,27.55,27.55,27.55,27.55,27.55,27.55,28.9,28.9,29.869999999999997,29.869999999999997,29.869999999999997,31.509999999999998,31.509999999999998,31.509999999999998,32.1,32.1,32.1,32.1,32.1,32.1,32.1,32.940000000000005,32.95,32.95,32.95,32.95,32.95,32.95,32.95,32.95,32.95,32.95,32.95,32.95,32.95,33.440000000000005,33.440000000000005,34.720000000000006,34.720000000000006,34.720000000000006,35.86,35.86,35.86,35.86,35.86,35.86,35.86,35.86,35.86,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.52,36.57000000000001,36.57000000000001,36.57000000000001,36.57000000000001,36.57000000000001,37.94,37.94,37.94,37.94,37.94,37.94,37.94,37.94,37.94,37.94,37.94,37.94,37.94,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.36999999999999,38.822222222222216,38.822222222222216,38.822222222222216,35.63999999999999,35.63999999999999,35.63999999999999,35.63999999999999,35.63999999999999,36.099999999999994,36.099999999999994,36.099999999999994,36.099999999999994,36.099999999999994,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216,38.822222222222216];
% plot(maxEGO,'r');
original_data_no_user = -[[0,0,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-4.8,-4.8,-4.8,-4.8,-4.8,-4.8,-4.8,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-29.1,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-32.7,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1,-36.1];
    [0,0,0,0,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-0.1,-3.3,-3.3,-3.3,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-7.7,-9.4,-9.4,-9.4,-9.4,-9.4,-9.4,-9.4,-9.4,-9.4,-9.4,-9.4,-9.4,-9.4,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10.2,-10.2,-10.2,-10.2,-10.2,-14,-14,-14,-14,-14,-14,-14,-20,-20,-20,-20,-20,-20,-20,-20,-20,-20,-22.9,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6,-33.6];
    [78.55555555555556,57.22222222222222,57.22222222222222,-4.6,-4.6,-4.6,-10.1,-10.1,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-32.3,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-35.2,-37.1,-37.1,-37.1,-37.1,-37.1,-37.1,-37.1];
    [46.666666666666664, 33.22222222222222, -12.2, -16.6, -16.6, -16.6, -18, -18, -26.9, -26.9, -26.9, -26.9, -26.9, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4, -37.4],-37.4*ones(1,201-78);
    [-4.7,-4.7,-4.7,-5.5,-5.5,-6,-6,-6,-6,-6,-6,-7.1,-7.1,-7.1,-7.1,-7.1,-7.1,-7.1,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.3,-7.7,-7.7,-7.7,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-9.2,-10.6,-11.4,-11.4,-11.4,-11.4,-11.4,-11.4,-11.4,-11.4,-11.4,-11.4,-11.4,-11.4,-11.4,-11.4,-11.4,-11.4,-12.7,-12.7,-12.7,-12.7,-12.7,-12.7,-12.7,-12.7,-12.7,-12.7,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.2,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-27.3,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1,-28.1],-28.1*ones(1,201-193)];


plot(1:200,mean(original_data_no_user(:,1:200)))
plot([1,200],[43.8,43.8])

%% count #play of each player
player = zeros(300,1);
for i = 1:2391
    player_id = original_data{i}.userid;
    player(player_id) = player(player_id)+1;
end
player(player==0)=[];
histc(player,[0,10,50,500])
% 74, 41, 10

%% count scores
score_bucket = zeros(2391,1);
for i = 1:length(original_data)
    data = original_data{i};
    score_bucket(i) = (1-data.score/3600/0.55/1000)*100*sign(data.score+1);
end
figure;
